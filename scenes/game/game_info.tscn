[gd_scene load_steps=3 format=3 uid="uid://bcn17yk5es8v"]

[ext_resource type="LabelSettings" uid="uid://b7xlkw0mgmeu4" path="res://assets/labels/numeric_label.tres" id="1_dhgsi"]

[sub_resource type="GDScript" id="GDScript_c6714"]
script/source = "extends Panel

@export var grid : GameGrid
@export var mines_left_label : Label

@export var menu_container : Control

func _ready() -> void:
	grid.cell_switched.connect(_on_cell_switched)
	grid.grid_generated.connect(_on_grid_generated)
	grid.losed.connect(_on_lose)
	grid.winned.connect(_on_win)

func _on_lose(mines_left:int) -> void:
	mines_left_label.text = \"Lose! Mines left: {0} / {1} ({2}%)\".format(
		[
			mines_left,
			grid._mines_coords.size(),
			int(100.0 - float(mines_left) / float(grid._mines_coords.size()) * 100.0),
		])

func _on_win()->void:
	mines_left_label.text = \"Win!\"

func _on_grid_generated(_size:Vector2i, mines_coords:Array[Vector2i])->void:
	_update_mines_left_label(mines_coords.size())

func _on_cell_switched(_index:Vector2i) -> void:
	var fake_mines_left := grid.get_fake_mines_left_count()
	var real_mines_left := grid.get_real_mines_left_count()
	print(\"Mines: fake: {0}, real: {1}\".format([fake_mines_left, real_mines_left]))
	_update_mines_left_label(fake_mines_left)

func _update_mines_left_label(mines: int)->void:
	mines_left_label.text = str(mines)

func _on_menu_btn_pressed() -> void:
	get_parent().hide()
	menu_container.show()
"

[node name="game_info" type="Panel" node_paths=PackedStringArray("mines_left_label")]
custom_minimum_size = Vector2(0, 50)
anchors_preset = 10
anchor_right = 1.0
grow_horizontal = 2
script = SubResource("GDScript_c6714")
mines_left_label = NodePath("MarginContainer/control/mines_left_label")

[node name="MarginContainer" type="MarginContainer" parent="."]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/margin_left = 5
theme_override_constants/margin_top = 5
theme_override_constants/margin_right = 5
theme_override_constants/margin_bottom = 5

[node name="control" type="Control" parent="MarginContainer"]
layout_mode = 2

[node name="menu_btn" type="Button" parent="MarginContainer/control"]
layout_mode = 1
anchors_preset = 9
anchor_bottom = 1.0
offset_right = 68.0
grow_vertical = 2
text = "Menu"

[node name="mines_left_label" type="Label" parent="MarginContainer/control"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
text = "01"
label_settings = ExtResource("1_dhgsi")
horizontal_alignment = 1
vertical_alignment = 1

[connection signal="pressed" from="MarginContainer/control/menu_btn" to="." method="_on_menu_btn_pressed"]
